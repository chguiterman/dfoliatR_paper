---
title: "*dfoliatR*: An R package for detection and analysis of insect defoliation signals in tree rings"
author:
  - name: Christopher H. Guiterman
    email: chguiterman@email.arizona.edu
    affiliation: a,b
    footnote: 1
  - name: Ann M. Lynch
    email: lyncha@email.arizona.edu
    affiliation: a,c
    # footnote: [2, 3]
  - name: Jodi N. Axelson
    email: jodi.axelson@berkeley.edu
    affiliation: c
    # footnote: 4
address:
  - code: a
    address: "Laboratory of Tree-Ring Research, University of Arizona, 1215 E Lowell St. Box 210045, Tucson, AZ, 85721"
  - code: b
    address: "Three Pines Forest Research, LLC, PO Box 225, Etna, NH, 03750"
  - code: c
    address: "U.S. Forest Service, Rocky Mountain Research Station, 1215 E Lowell St. Box 210045, Tucson, AZ, 85721"
  - code: d
    address: "Dept of Environmental Science, Policy & Management, University of California, Berkeley, Berkeley, CA 94720"
footnote:
  - code: 1
    text: "Corresponding Author"
#   - code: 2
#     text: "Laboratory of Tree-Ring Research, University of Arizona, 1215 E Lowell St. Box 210045, Tucson, AZ, 85721"
#   - code: 3
#     text: "U.S. Forest Service, Rocky Mountain Research Station, 1215 E Lowell St. Box 210045, Tucson, AZ, 85721"
#   - code: 4
#     text: "Dept of Environmental Science, Policy & Management, University of California, Berkeley, Berkeley, CA 94720"
abstract: |
    We present a new R package to provide dendroecologists with tools to identify, quantify, analyze, and visualize growth
    suppression events in tree rings produced by insect defoliation. The 'dfoliatR' library is based on the Fortran V program 
    OUTBREAK, and builds on existing resources in the R computing environment. 'dfoliatR' expands on OUTBREAK to provide greater
    control of supression thresholds, additional output tables, and high-quality graphics. To use 'dfoliatR' requires 
    standardized ring-width measurements from insect host trees and an indexed tree-ring chronology from local non-host trees. 
    It performs an indexing procedure to remove the climatic signal represented in the non-host chronology from the host-tree
    series. It then infers defoliation events in individual trees. Site-level analyses identify outbreak events
    that synchronously affect a user-defined number or proportion of the host trees. Functions are available for
    summary statistics and graphics of tree- and site-level series. 
    
    \hfill\break
keywords: |
  Dendroecology, spruce budworm, Choristoneura, pandora moth, Coloradia pandora Blake, larch-bud-moth
  \newpage
journal: "Tree-Ring Research"
date: "`r Sys.Date()`"
bibliography: mybibfile.bib
linenumbers: true
#numbersections: true
csl: ecology.csl
output: rticles::elsevier_article
# output:
#   bookdown::pdf_book:
#     base_format: rticles::elsevier_article
#   bookdown::word_document2:
#     reference_docx: "../common/word-styles-reference-01.docx"
#     toc: false
#     toc_depth: 2
#     fig_caption: yes
#     df_print: kable
layout: review
preamble: |
  \usepackage{amsmath}
---


Introduction
==========================


The `dfoliatR` library adds to a growing suite `R` packages designed for dendrochronology. Stemming from the `dplR` library [@Bunn2008] that enables `R` users to read and write an array of tree-ring data formats, standaridize ring widths, build and evaluate chronologies, perform qaulity control (to name a few), one can now also measure ring widths [@Shi2019; @Lara2015], perform and check crossdating [@Bunn2010], and perform many analytical tests [@Jevsenak2018; @Zang2015]. Tools for assessing stand dynamics and disturbance analyses are under rapid development, with new packages for assessing growth and release events [`TRADER`: @Altman2014], metrics of growth resilience [`pointRes`: @VanderMaaten-Theunissen2015], and fire history [`burnr`: @Malevich2018]. The key objective of `dfoliatR` is to provide tools to identify and analyse insect defoliation and outbreak events by building on the methods employed the FORTRAN program OUTBREAK [@Swetnam1989]. What sets `dfoliatR` apart from packages such as `TRADER` is that it explicitly performs an indexing procedue on host-tree series to remove climatic and other non-defoliation related signals represented by non-host tree species. Insect defoliation signals are identified in the disturbance index by the duration and magnitude of negative departures.  

`dfoliatR` draws upon data formats in `dplR` that are commonly employed by other tree-ring libraries. It uses and outputs data formats that faciliate the use packages embodied by `tidyverse` [@Wickham2019] that include efficient data manipulation [`dplyr`: @Wickham2020dplyr] and graphics [`ggplot2`: @wickham2016ggplot2]. 

In this paper, we describe the statistical methods employed by `dfoliatR`, its availability, and run through analyses for a signle site in New Mexico. Users need not have much experience in `R` to replicate the analyses and graphics below. All `R` code presented below is executatable in an `R` session once the required libraries are installed and loaded. Support documentation in addition to this paper is provided within the package via standard help menus (accessed by typing `?` before a function name) and on the package website ([https://chguiterman.github.io/dfoliatR/](https://chguiterman.github.io/dfoliatR/)), which includes up-to-date vignettes that describe in detail the functionality of the software. Code to create a preprint of this manuscript including the `R` scripts is available from [https://github.com/chguiterman/dfoliatR_paper](https://github.com/chguiterman/dfoliatR_paper).

Overview of the software
==========================

The `dfoliatR` library requires two sets of tree-ring data to identify defoliation and outbreak events:

* Standardized ring-width series for individual trees of the host species
*	Standardized tree-ring chronology from a local non-host species

Users can develop these data sets in software of their choosing, such as `dplR` or ARSTAN. It is important that the host-tree data include only one tree-ring series per tree. Both `dplR` and ARSTAN have options for averaging mutliple sample series into a tree-level series. The tree-ring series and chronology can be read into `R` via several available `dplR` functions. 

At the heart of `dfoliatR` lies two functions: `defoliate_trees()` and `outbreak()`. These identify defoliation event son individual trees and thenc omposite across mutliple trees for a given site to identify outbreak events. It is up to the researcher to distinguish these separate spatial scales of analysis, `dfoliatR` then provides a set of functions to visualize and statistically summarize tree-level defoliation and site-level outbreak events, which will be discussed further.

## Identifying Defoliation of Trees

The `defoliate_trees()` function will often be the point of entry to the `dfoliatR` library. It performs two processes: removing the non-defoliatation growth signal from the host-tree series and identifying defoliation events for each host tree. The climatic or non-defoliation signals in each host-tree series is represented by the non-host chronology or a climate reconstruction. This indexing procedure generates the "growth suppression index" (GSI) in which disturbance is the predominant signal. The GSI is calculated as in @Swetnam1985 and @Swetnam1989, 
\begin{align}
\textrm{GSI}_{i} = \textrm{H}_{i} - \left( \textrm{NH}_{i} - \overline{\textrm{NH}} \right) \frac{\sigma_{\textrm{H}}}{\sigma_{\textrm{NH}}} \
\end{align}
where H and NH are the host-tree series and the non-host chronology, in year i, respectively. Only the common period between each host-tree series and the non-host chronology are used in Equation 1. The non-host chronology is scaled by its mean ($\overline{\textrm{NH}} \approx 1.0$) and multiplied by the ratio of host and non-host standard deviations ($\frac{\sigma_{\textrm{H}}}{\sigma_{\textrm{NH}}}$), which approximates the variance of the host tree series. This "corrected" non-host chronology is subtracted from the host-tree series.

Negative departures in the normalized GSI that surpass user-defined thresholds in duration and magnitude are defined as *defoliation events*. As in OUTBREAK, defoliation events have a single year of maximum departure (the variable 'max_reduction' in `defoliate_trees()`) that is used to assess the magnitude of growth suppression. The default setting is -1.28 (in units of standard deviation), which was previously determined as representative of WSBW effects (**cite**). Duration is assessed by examining sequences of negative GSI before and after the year of maximum departure. Each defoliation event is allowed one positive excersion on each side of the maximum departure year. Duration is assessed across the entire sequence that includes up to two positive excursions. The default duration is eight years, following OUTBREAK, as is commonly used in WSBW studies (**cite**). Defoliator insects vary in their durations of defoliations and outbreaks, so researchers should exmaine their data and perform sensitivity tests to to find a representative event duration.  

Researchers are given the options to extend defoliation events by bridging between successive events and allowing potentially short-duration events that occur at the end of the series. Bridging allows multiple events that are separated by a single year to be combined and considered as one defoliation event. We urge researchers to use this option carefully, as there is no setting to limit the number of potentially bridged events. Series end events is an option that can be used when the trees were sampled during a known defoliation event, which in many cases is what led the to the site being sampled for the reconstruction. This option eliminates the duration parameter, but all other thresholds, and bridging, still apply. These options are not available in OUTBREAK. 

## Identifying Outbreak Events

The individual tree defoliation series are composited in an additional step to identify *outbreak events* that synchronously affect mutliple trees. Users have options to define the number and/or the proportion of trees required for a defoliation event to be considered an outbreak. 


 

Availability and installation
==========================

The `dfoliatR` is provided free and open source [@chris_guiterman_2020_3626136]. It is provided to `R` users via the Comprehensive R Archive Network (CRAN; [https://cran.r-project.org/](https://cran.r-project.org/)). To install `dfoliatR` from CRAN use

```{r, echo=TRUE, eval=FALSE}
install.packages("dfoliatR")
```

In each `R` session, `dfoliatR` can be loaded via

```{r, echo=TRUE, eval=FALSE}
library(dfoliatR)
```

Development versions of `dfoliatR` are available on Github and installed using the `devtools` library,

```{r, echo=TRUE, eval=FALSE}
devtools::install_github("chguiterman/dfoliatR")
```

Issues, bug reports, and ideas for improving `dfoliatR` can be posted to [https://github.com/chguiterman/dfoliatR/issues](https://github.com/chguiterman/dfoliatR/issues). As an Open Source library, we welcome and encourage community involvement in future development. The best ways to contribute to `dfoliatR` are through standard Github procedures or by contacting the first author.


Example Usage
==========================

## Tree-level defoliation events



## Site-level events


Evaluation
==========================

Extensions
==========================



References {#references .unnumbered}
==========================
